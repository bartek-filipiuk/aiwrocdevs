---
import Layout from '../../layouts/Layout.astro';
import { supabase } from '../../lib/supabase';
import type { MeetupDetails } from '../../lib/supabase';

// Check authentication
const sessionCookie = Astro.cookies.get('sb-access-token');
if (!sessionCookie) {
  return Astro.redirect('/admin/login');
}

// Fetch current meetup data
let meetupData: MeetupDetails | null = null;
try {
  const { data } = await supabase
    .from('meetup_details')
    .select('*')
    .single();

  meetupData = data as MeetupDetails;
} catch (e) {
  console.error('Error fetching data:', e);
}

// Default data structure
const defaultData: MeetupDetails = {
  id: 1,
  title: 'AI WrocDevs Meetup',
  date: '2025-11-27',
  location: 'Wrocław, Poland',
  description: 'Join us for an exciting meetup focused on Artificial Intelligence, Machine Learning, and the future of technology in Wrocław.',
  agenda: [
    {
      time: '09:00',
      title: 'Registration & Coffee',
      description: 'Welcome to AI WrocDevs! Grab a coffee and network with fellow attendees.'
    }
  ],
  additional_info: 'This meetup is perfect for developers, data scientists, AI enthusiasts, and anyone interested in learning about artificial intelligence and its applications.',
  signup_link: 'https://forms.google.com/your-form-link',

  // Event Location details
  location_detail_1_title: 'Address',
  location_detail_1_description: 'Wrocław, Poland',
  location_detail_2_title: 'Duration',
  location_detail_2_description: 'Full day event with networking',
  location_detail_3_title: 'Venue',
  location_detail_3_description: 'Modern tech hub with facilities',
  map_embed_code: '',

  // What to Expect features
  expect_feature_1_title: 'Networking',
  expect_feature_1_description: 'Connect with AI enthusiasts and tech professionals',
  expect_feature_2_title: 'Learn',
  expect_feature_2_description: 'Discover latest AI trends and technologies',
  expect_feature_3_title: 'Share',
  expect_feature_3_description: 'Exchange ideas and experiences',

  // Ready to Join section
  join_heading: 'Ready to Join?',
  join_subtitle: 'Secure your spot at our next meetup. Limited seats available!',
  join_button_text: 'Register Now',

  updated_at: new Date().toISOString()
};

const data = meetupData || defaultData;
---

<Layout title="Admin Dashboard - AI WrocDevs">
  <main class="dashboard-page">
    <div class="dashboard-header">
      <div class="container">
        <div class="header-content">
          <div>
            <h1><span class="gradient-text">Admin Dashboard</span></h1>
            <p>Edit meetup details</p>
          </div>
          <div class="header-actions">
            <a href="/" class="btn btn-secondary">View Site</a>
            <button id="logout-btn" class="btn btn-secondary">Logout</button>
          </div>
        </div>
      </div>
    </div>

    <div class="container dashboard-container">
      <div class="quick-nav">
        <a href="/admin/pages" class="quick-nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          <span>Manage Pages</span>
        </a>
        <a href="/admin/menu" class="quick-nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          <span>Manage Menu</span>
        </a>
      </div>

      <div id="success-message" class="success-message">
        Changes saved successfully!
      </div>

      <div id="error-message" class="error-message"></div>

      <form id="meetup-form" class="dashboard-form">
        <div class="form-section">
          <h2>Event Details</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="title">Event Title</label>
              <input
                type="text"
                id="title"
                name="title"
                required
                value={data.title}
              />
            </div>

            <div class="form-group">
              <label for="date">Event Date</label>
              <input
                type="date"
                id="date"
                name="date"
                required
                value={data.date}
              />
            </div>

            <div class="form-group">
              <label for="location">Location</label>
              <input
                type="text"
                id="location"
                name="location"
                required
                value={data.location}
              />
            </div>

            <div class="form-group">
              <label for="signup_link">Signup Form Link</label>
              <input
                type="url"
                id="signup_link"
                name="signup_link"
                required
                value={data.signup_link}
                placeholder="https://forms.google.com/..."
              />
            </div>
          </div>

          <div class="form-group">
            <label for="description">Event Description</label>
            <textarea
              id="description"
              name="description"
              required
              rows="3"
            >{data.description}</textarea>
          </div>
        </div>

        <div class="form-section">
          <div class="section-header">
            <h2>Agenda Items</h2>
            <button type="button" id="add-agenda-btn" class="btn btn-secondary btn-sm">
              + Add Item
            </button>
          </div>

          <div id="agenda-container" class="agenda-container">
            {data.agenda.map((item, index) => (
              <div class="agenda-item-form" data-index={index}>
                <div class="agenda-header">
                  <h4>Agenda Item #{index + 1}</h4>
                  <button type="button" class="remove-agenda-btn" data-index={index}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                <div class="agenda-fields">
                  <div class="form-group">
                    <label>Time</label>
                    <input
                      type="text"
                      name={`agenda_time_${index}`}
                      required
                      value={item.time}
                      placeholder="09:00"
                    />
                  </div>
                  <div class="form-group">
                    <label>Title</label>
                    <input
                      type="text"
                      name={`agenda_title_${index}`}
                      required
                      value={item.title}
                    />
                  </div>
                  <div class="form-group full-width">
                    <label>Description</label>
                    <textarea
                      name={`agenda_description_${index}`}
                      required
                      rows="2"
                    >{item.description}</textarea>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <div class="form-section">
          <h2>Additional Information</h2>
          <div class="form-group">
            <label for="additional_info">Additional Details</label>
            <textarea
              id="additional_info"
              name="additional_info"
              required
              rows="6"
              placeholder="Enter additional information about the event..."
            >{data.additional_info}</textarea>
            <p class="help-text">Use line breaks to separate paragraphs</p>
          </div>
        </div>

        <div class="form-section">
          <h2>Event Location Details</h2>
          <p class="section-description">Three detail cards displayed on the homepage (icons are fixed)</p>

          <div class="detail-card-group">
            <div class="detail-card-item">
              <h3>Detail Card 1</h3>
              <div class="form-group">
                <label for="location_detail_1_title">Title</label>
                <input
                  type="text"
                  id="location_detail_1_title"
                  name="location_detail_1_title"
                  value={data.location_detail_1_title || 'Address'}
                  required
                  placeholder="e.g., Address"
                />
              </div>
              <div class="form-group">
                <label for="location_detail_1_description">Description</label>
                <input
                  type="text"
                  id="location_detail_1_description"
                  name="location_detail_1_description"
                  value={data.location_detail_1_description || data.location}
                  required
                  placeholder="e.g., Wrocław, Poland"
                />
              </div>
            </div>

            <div class="detail-card-item">
              <h3>Detail Card 2</h3>
              <div class="form-group">
                <label for="location_detail_2_title">Title</label>
                <input
                  type="text"
                  id="location_detail_2_title"
                  name="location_detail_2_title"
                  value={data.location_detail_2_title || 'Duration'}
                  required
                  placeholder="e.g., Duration"
                />
              </div>
              <div class="form-group">
                <label for="location_detail_2_description">Description</label>
                <input
                  type="text"
                  id="location_detail_2_description"
                  name="location_detail_2_description"
                  value={data.location_detail_2_description || 'Full day event with networking'}
                  required
                  placeholder="e.g., Full day event with networking"
                />
              </div>
            </div>

            <div class="detail-card-item">
              <h3>Detail Card 3</h3>
              <div class="form-group">
                <label for="location_detail_3_title">Title</label>
                <input
                  type="text"
                  id="location_detail_3_title"
                  name="location_detail_3_title"
                  value={data.location_detail_3_title || 'Venue'}
                  required
                  placeholder="e.g., Venue"
                />
              </div>
              <div class="form-group">
                <label for="location_detail_3_description">Description</label>
                <input
                  type="text"
                  id="location_detail_3_description"
                  name="location_detail_3_description"
                  value={data.location_detail_3_description || 'Modern tech hub with facilities'}
                  required
                  placeholder="e.g., Modern tech hub with facilities"
                />
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="map_embed_code">Google Maps Embed Code</label>
            <textarea
              id="map_embed_code"
              name="map_embed_code"
              rows="4"
              placeholder='Paste your Google Maps iframe embed code here, e.g., <iframe src="..." width="600" height="450"></iframe>'
            >{data.map_embed_code || ''}</textarea>
            <p class="help-text">Paste the embed iframe code from Google Maps (Share → Embed a map)</p>
          </div>
        </div>

        <div class="form-section">
          <h2>What to Expect Features</h2>
          <p class="section-description">Three feature cards displayed on the homepage (icons are fixed)</p>

          <div class="detail-card-group">
            <div class="detail-card-item">
              <h3>Feature 1</h3>
              <div class="form-group">
                <label for="expect_feature_1_title">Title</label>
                <input
                  type="text"
                  id="expect_feature_1_title"
                  name="expect_feature_1_title"
                  value={data.expect_feature_1_title || 'Networking'}
                  required
                  placeholder="e.g., Networking"
                />
              </div>
              <div class="form-group">
                <label for="expect_feature_1_description">Description</label>
                <input
                  type="text"
                  id="expect_feature_1_description"
                  name="expect_feature_1_description"
                  value={data.expect_feature_1_description || 'Connect with AI enthusiasts and tech professionals'}
                  required
                  placeholder="e.g., Connect with AI enthusiasts and tech professionals"
                />
              </div>
            </div>

            <div class="detail-card-item">
              <h3>Feature 2</h3>
              <div class="form-group">
                <label for="expect_feature_2_title">Title</label>
                <input
                  type="text"
                  id="expect_feature_2_title"
                  name="expect_feature_2_title"
                  value={data.expect_feature_2_title || 'Learn'}
                  required
                  placeholder="e.g., Learn"
                />
              </div>
              <div class="form-group">
                <label for="expect_feature_2_description">Description</label>
                <input
                  type="text"
                  id="expect_feature_2_description"
                  name="expect_feature_2_description"
                  value={data.expect_feature_2_description || 'Discover latest AI trends and technologies'}
                  required
                  placeholder="e.g., Discover latest AI trends and technologies"
                />
              </div>
            </div>

            <div class="detail-card-item">
              <h3>Feature 3</h3>
              <div class="form-group">
                <label for="expect_feature_3_title">Title</label>
                <input
                  type="text"
                  id="expect_feature_3_title"
                  name="expect_feature_3_title"
                  value={data.expect_feature_3_title || 'Share'}
                  required
                  placeholder="e.g., Share"
                />
              </div>
              <div class="form-group">
                <label for="expect_feature_3_description">Description</label>
                <input
                  type="text"
                  id="expect_feature_3_description"
                  name="expect_feature_3_description"
                  value={data.expect_feature_3_description || 'Exchange ideas and experiences'}
                  required
                  placeholder="e.g., Exchange ideas and experiences"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2>Ready to Join Section</h2>
          <p class="section-description">Call-to-action section at the bottom of the homepage</p>

          <div class="form-group">
            <label for="join_heading">Heading</label>
            <input
              type="text"
              id="join_heading"
              name="join_heading"
              value={data.join_heading || 'Ready to Join?'}
              required
              placeholder="e.g., Ready to Join?"
            />
          </div>

          <div class="form-group">
            <label for="join_subtitle">Subtitle</label>
            <input
              type="text"
              id="join_subtitle"
              name="join_subtitle"
              value={data.join_subtitle || 'Secure your spot at our next meetup. Limited seats available!'}
              required
              placeholder="e.g., Secure your spot at our next meetup. Limited seats available!"
            />
          </div>

          <div class="form-group">
            <label for="join_button_text">Button Text</label>
            <input
              type="text"
              id="join_button_text"
              name="join_button_text"
              value={data.join_button_text || 'Register Now'}
              required
              placeholder="e.g., Register Now"
            />
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <span class="btn-text">Save Changes</span>
            <span class="btn-loading" style="display: none;">
              <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Saving...
            </span>
          </button>
        </div>
      </form>
    </div>
  </main>
</Layout>

<style>
  .dashboard-page {
    min-height: 100vh;
    background-color: var(--bg-primary);
    padding-bottom: 4rem;
  }

  .dashboard-header {
    background-color: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    padding: 2rem 0;
    margin-bottom: 2rem;
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-content h1 {
    font-size: 2rem;
    margin-bottom: 0.25rem;
  }

  .header-content p {
    color: var(--text-secondary);
    font-size: 1rem;
  }

  .header-actions {
    display: flex;
    gap: 1rem;
  }

  .dashboard-container {
    max-width: 1000px;
  }

  .quick-nav {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .quick-nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.3s ease;
  }

  .quick-nav-item:hover {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15);
  }

  .quick-nav-item svg {
    color: var(--accent-primary);
    flex-shrink: 0;
  }

  .quick-nav-item span {
    font-weight: 600;
    font-size: 1.05rem;
  }

  .success-message,
  .error-message {
    padding: 1rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    display: none;
  }

  .success-message {
    background-color: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: #34d399;
  }

  .success-message.show {
    display: block;
    animation: slideDown 0.3s ease-out;
  }

  .error-message {
    background-color: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #fca5a5;
  }

  .error-message.show {
    display: block;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .dashboard-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .form-section {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 1rem;
    padding: 2rem;
  }

  .form-section h2 {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .section-header h2 {
    margin-bottom: 0;
  }

  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  .form-group label {
    color: var(--text-primary);
    font-weight: 500;
    font-size: 0.95rem;
  }

  .form-group input,
  .form-group textarea {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 0.75rem;
    color: var(--text-primary);
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .help-text {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-top: 0.25rem;
  }

  .agenda-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .agenda-item-form {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
  }

  .agenda-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .agenda-header h4 {
    color: var(--text-primary);
    font-size: 1.1rem;
  }

  .remove-agenda-btn {
    background-color: rgba(239, 68, 68, 0.1);
    color: var(--error);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 0.375rem;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .remove-agenda-btn:hover {
    background-color: rgba(239, 68, 68, 0.2);
  }

  .agenda-fields {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 1rem;
  }

  .section-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
  }

  .detail-card-group {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .detail-card-item {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
  }

  .detail-card-item h3 {
    color: var(--accent-primary);
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 1rem;
  }

  .spinner {
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .btn-loading {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  @media (max-width: 768px) {
    .header-content {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .form-section {
      padding: 1.5rem;
    }

    .agenda-fields {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  import { supabase } from '../../lib/supabase';

  let agendaCount = document.querySelectorAll('.agenda-item-form').length;

  // Logout functionality
  document.getElementById('logout-btn')?.addEventListener('click', async () => {
    await supabase.auth.signOut();
    document.cookie = 'sb-access-token=; path=/; max-age=0';
    document.cookie = 'sb-refresh-token=; path=/; max-age=0';
    window.location.href = '/admin/login';
  });

  // Add agenda item
  document.getElementById('add-agenda-btn')?.addEventListener('click', () => {
    const container = document.getElementById('agenda-container');
    const newItem = document.createElement('div');
    newItem.className = 'agenda-item-form';
    newItem.dataset.index = agendaCount.toString();
    newItem.innerHTML = `
      <div class="agenda-header">
        <h4>Agenda Item #${agendaCount + 1}</h4>
        <button type="button" class="remove-agenda-btn" data-index="${agendaCount}">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="agenda-fields">
        <div class="form-group">
          <label>Time</label>
          <input type="text" name="agenda_time_${agendaCount}" required placeholder="09:00" />
        </div>
        <div class="form-group">
          <label>Title</label>
          <input type="text" name="agenda_title_${agendaCount}" required />
        </div>
        <div class="form-group full-width">
          <label>Description</label>
          <textarea name="agenda_description_${agendaCount}" required rows="2"></textarea>
        </div>
      </div>
    `;
    container?.appendChild(newItem);
    agendaCount++;
    attachRemoveListeners();
  });

  // Remove agenda item
  function attachRemoveListeners() {
    document.querySelectorAll('.remove-agenda-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const target = e.currentTarget as HTMLButtonElement;
        const item = target.closest('.agenda-item-form');
        if (item && document.querySelectorAll('.agenda-item-form').length > 1) {
          item.remove();
          renumberAgendaItems();
        } else {
          alert('You must have at least one agenda item.');
        }
      });
    });
  }

  function renumberAgendaItems() {
    const items = document.querySelectorAll('.agenda-item-form');
    items.forEach((item, index) => {
      const header = item.querySelector('.agenda-header h4');
      if (header) {
        header.textContent = `Agenda Item #${index + 1}`;
      }
    });
  }

  attachRemoveListeners();

  // Form submission
  const form = document.getElementById('meetup-form') as HTMLFormElement;
  const successMessage = document.getElementById('success-message');
  const errorMessage = document.getElementById('error-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const btnText = form.querySelector('.btn-text') as HTMLElement;
    const btnLoading = form.querySelector('.btn-loading') as HTMLElement;
    const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;

    // Show loading state
    btnText.style.display = 'none';
    btnLoading.style.display = 'flex';
    submitBtn.disabled = true;
    successMessage?.classList.remove('show');
    errorMessage?.classList.remove('show');

    // Collect agenda items
    const agendaItems: Array<{ time: string; title: string; description: string }> = [];
    const agendaElements = document.querySelectorAll('.agenda-item-form');

    agendaElements.forEach((item, index) => {
      const timeInput = item.querySelector(`input[name="agenda_time_${index}"]`) as HTMLInputElement;
      const titleInput = item.querySelector(`input[name="agenda_title_${index}"]`) as HTMLInputElement;
      const descInput = item.querySelector(`textarea[name="agenda_description_${index}"]`) as HTMLTextAreaElement;

      if (timeInput && titleInput && descInput) {
        agendaItems.push({
          time: timeInput.value,
          title: titleInput.value,
          description: descInput.value
        });
      }
    });

    const updateData = {
      title: formData.get('title') as string,
      date: formData.get('date') as string,
      location: formData.get('location') as string,
      description: formData.get('description') as string,
      signup_link: formData.get('signup_link') as string,
      additional_info: formData.get('additional_info') as string,
      agenda: agendaItems,

      // Event Location details
      location_detail_1_title: formData.get('location_detail_1_title') as string,
      location_detail_1_description: formData.get('location_detail_1_description') as string,
      location_detail_2_title: formData.get('location_detail_2_title') as string,
      location_detail_2_description: formData.get('location_detail_2_description') as string,
      location_detail_3_title: formData.get('location_detail_3_title') as string,
      location_detail_3_description: formData.get('location_detail_3_description') as string,
      map_embed_code: formData.get('map_embed_code') as string,

      // What to Expect features
      expect_feature_1_title: formData.get('expect_feature_1_title') as string,
      expect_feature_1_description: formData.get('expect_feature_1_description') as string,
      expect_feature_2_title: formData.get('expect_feature_2_title') as string,
      expect_feature_2_description: formData.get('expect_feature_2_description') as string,
      expect_feature_3_title: formData.get('expect_feature_3_title') as string,
      expect_feature_3_description: formData.get('expect_feature_3_description') as string,

      // Ready to Join section
      join_heading: formData.get('join_heading') as string,
      join_subtitle: formData.get('join_subtitle') as string,
      join_button_text: formData.get('join_button_text') as string,

      updated_at: new Date().toISOString()
    };

    try {
      const { error } = await supabase
        .from('meetup_details')
        .upsert(updateData, { onConflict: 'id' });

      if (error) {
        throw error;
      }

      successMessage?.classList.add('show');
      setTimeout(() => {
        successMessage?.classList.remove('show');
      }, 5000);

    } catch (error: any) {
      if (errorMessage) {
        errorMessage.textContent = error.message || 'Failed to save changes';
        errorMessage.classList.add('show');
      }
    } finally {
      // Reset button state
      btnText.style.display = 'block';
      btnLoading.style.display = 'none';
      submitBtn.disabled = false;
    }
  });
</script>
